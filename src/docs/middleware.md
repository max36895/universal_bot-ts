# Middleware

`umbot` Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ **middleware Ð² ÑÑ‚Ð¸Ð»Ðµ `telegraf` Ð¸ `vk-io`** â€” Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ **Ð´Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ¸** (`BotController.action`).

## ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

```ts
// Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ middleware (Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼)
bot.use(async (ctx, next) => {
    console.log('Ð—Ð°Ð¿Ñ€Ð¾Ñ:', ctx.appContext.appType);
    await next(); // Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð²Ñ‹Ð·Ð²Ð°Ñ‚ÑŒ next() Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ñ
});

// Ð”Ð»Ñ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¹ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹
bot.use('alisa', async (ctx, next) => {
    if (!ctx.appContext.requestObject?.session?.user_id) {
        ctx.text = 'ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ';
        ctx.isEnd = true;
        // next() Ð½Ðµ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ â†’ action() Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑÑ
        return;
    }
    await next();
});
```

## âš ï¸ Ð’Ð°Ð¶Ð½Ð¾

- Middleware Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ BotController (Ñ text, isEnd, userData Ð¸ Ñ‚.Ð´.).
- Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ð½Ðµ Ð²Ñ‹Ð·Ð¾Ð²ÐµÑ‚Ðµ next(), Ñ‚Ð¾ action() Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð²Ñ‹Ð·Ð²Ð°Ð½ â€” ÑÑ‚Ð¾ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾.
- ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ: ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ, Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼ÐµÐ½Ð½Ð¾-ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ðµ middleware.
- Ð˜Ð·Ð±ÐµÐ³Ð°Ð¹Ñ‚Ðµ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¸Ñ… Ñ†ÐµÐ¿Ð¾Ñ‡ÐµÐº middleware (>5)
