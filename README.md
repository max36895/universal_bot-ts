Универсальное приложение для создания навыков и ботов
=====================================================
Документация
------------
Документация: -. Для получения информации о работе приложения можно в телеграм канале [MM](https://t.me/joinchat/AAAAAFM8AcuniLTwBLuNsw) или группе [MM](https://t.me/mm_universal_bot)

Описание
--------
Приложение позволяет создать навык для Яндекс.Алиса, Маруси, бота для vk, viber или telegram, с идентичной логикой.
Типы доступных приложений в дальнейшем будут дополняться.

При необходимости есть возможность создать свой тип приложения.
Тип приложения должен быть прописан в `mmApp.appType`, по умолчанию alisa.

Запуск
------
1. Установить зависимости.
```bash
npm i
```
2. Написать логику приложения
3. Собрать проект
```bash
npm run build
```
3. Запустить. Для запуска нужно в директории приложения создать package.json
```json
{
  "name": "Название приложения",
  "description": "Описание",
  "main": "index.js (Путь к индексному файлу)",
  "scripts": {
    "start": "micro",
    "build": "rm -rf dist/ && tsc"
  },
  "dependencies": {
    
  }
}
```
После, запустить сервер командой:
```bash
npm start
``` 

Тестирование
------------
Чтобы запустить тесты, нужно воспользоваться 1 из способов:
1. Собрать и запустить тесты, когда происходит сборка приложения + сразу запускаются тесты.
```bash
npm run bt
```
2. Запуск тестов, когда запускаются только тесты. Важно чтобы приложение было уже собранно.
```bash
npm test
```


# SSL
Для работы некоторых приложений, необходимо иметь ssl сертификат. Поэтому нужно его получить.
## Install acme.sh
```bash
curl https://get.acme.sh | sh
```
## Issue and install certificate for site
```bash
acme.sh --issue -d {{domain}} -w {{domain dir}}
~/.acme.sh/acme.sh  --issue -d {{domain}} -w {{domain dir}}
```
1. domain - Название домена (example.com)
2. domain dir - Директория, в которой находится сайт

```bash
acme.sh --install-cert -d {{domain}} --key-file {{key file}} --fullchain-file {{cert file}} --reloadcmd "service nginx reload"
~/.acme.sh/acme.sh --install-cert -d {{domain}} --key-file {{key file}} --fullchain-file {{cert file}} --reloadcmd "service nginx reload"
```
1. domain - Название домена (example.com)
2. key file - Директория, в которой хранится ключ сертификата
3. cert file - Директория, в которой сохранится сертификат

## Важно!
После получения сертификата, необходимо перезапустить сервер `sudo service nginx reload`

# Ngrok
Используется для локального тестирование навыка. Актуально для Алисы
## Установка
Смотри на сайте [ngrok](https://ngrok.com/download)
## Запуск
```bash
ngrok http --host-header=rewrite <domain>:port
```
1. domain - локальный адрес сайта. Важно сайт должен быть доступен на машине! (Прописан в hosts)
2. port - Порт для подключения. Для бесплатного аккаунта нельзя использовать 443 порт

После успешного запуска, нужно скопировать полученную ссылку с https, и вставить в консоль разработчика.

# Тестирование
Протестировать навык можно 2 способами:
1. Через ngrok
2. Через консоль
## Тестирование через Ngroc
Для тестирование через ngrok, необходимо скачать программу, а также запустить её.
После чего полученную ссылку с https, вставить в [консоль разработчика](https://dialogs.yandex.ru/developer), и перейти на вкладку тестирования.
Данное действие актуально для Алисы.

## Тестирование в консоли
Для тестирования необходимо использовать тот же минимальный код что и при запуске. С той лишь разнице, что нужно вызывать метод test вместо run.
Проще говоря, файл на который будет слаться webhook. См. демо.
После чего откроется консоль с ботом. Для выхода из режима тестирования нужно:
1. Если навык в определенный момент ставит `isEnd` в True(Что означает завершение диалога), то нужно дойти до того места сценария, в котором диалог завершается.
2. Вызвать команду exit.

Помимо ответов, можно вернуть время обработки команд.

Помощь
------
Любая помощь и поддержка приветствуется.
Если будут найдены различные ошибки или предложения по улучшению, то смело пишите на мою почту: maximco36895@yandex.ru
